// Log by Josh Avanier
var Log={log:[],status:function(){return"undefined"==this.log[this.log.length-1].e?!0:!1},timer:function(a){if(a){var b=this.time.convert(this.time.parse(this.log[this.log.length-1].s)).getTime();setInterval(function(){var a=Math.floor(((new Date).getTime()-b)/1E3),d=Math.floor(a/60),g=Math.floor(d/60);g="0"+g%24;d="0"+d%60;a="0"+a%60;document.getElementById("timer").innerHTML=g.substr(-2)+":"+d.substr(-2)+":"+a.substr(-2)},1E3)}},display:function(a,b){a=void 0===a?Log.log:a;b=void 0===b?"logTable":
b;for(var c=function(a,c){var d=document.getElementById(b).insertRow(c),f=d.insertCell(0),g=d.insertCell(1),h=d.insertCell(2),l=d.insertCell(3),t=d.insertCell(4),v=d.insertCell(5);d=d.insertCell(6);var r=Log.time.parse(a.s),u=Log.time.parse(a.e),w=Log.time.convert(r);w=Aequirys.display(Aequirys.convert(new Date(w.getFullYear(),w.getMonth(),w.getDate())));f.innerHTML=w;f=Log.time.stamp(r);g.innerHTML=f;g=Log.time.stamp(u);h.innerHTML=g;h=Log.time.duration(r,u).toFixed(2);l.innerHTML=h;t.innerHTML=
a.c;v.innerHTML=a.t;d.innerHTML=a.d},d=function(a,b){var c=null==a?0:a.length;if(!c)return[];b=c-(void 0===b?1:b);var d=0>b?0:b;var f=c;if(c=null==a?0:a.length){d=null==d?0:d;f=void 0===f?c:f;0>d&&(d=-d>c?0:c+d);f=f>c?c:f;0>f&&(f+=c);c=d>f?0:f-d>>>0;d>>>=0;f=-1;for(var g=Array(c);++f<c;)g[f]=a[f+d];d=g}else d=[];return d}(a,50),g=0,f=d.length;g<f;g++)c(d[g],g)},vis:{line:function(a,b){a=void 0===a?this.log:a;for(var c=Log.time,d=0,g=0,f=function(a,f){var k=document.createElement("div");k.className=
"psr t0 sh1 mb2 lf "+("PHO"==a.c?"bg-blu":"RES"==a.c?"bg-grn":"DSG"==a.c?"bg-red":"ACA"==a.c?"bg-ylw":"bg-blanc");k.style.width=f.p+"%";k.style.margin="0 0 0 "+f.m+"%";document.getElementById(b+c.date(c.parse(a.s))).appendChild(k);d=f.p;g=f.dp},h=function(a,b){var f=(a-b)/86400*100,k=c.convert(b),h=k.getFullYear(),m=k.getMonth(),l=k.getDate();k=((new Date(h,m,l,k.getHours(),k.getMinutes(),k.getSeconds())).getTime()/1E3-(new Date(h,m,l)).getTime()/1E3)/86400*100;return{dp:k,p:f,m:k-(d+g)}},l=function(a){g=
d=0;var c=document.createElement("div");c.className="db wf sh1 mt2 mb3 bsia bg-noir br1";c.id=b+a;document.getElementById(b).appendChild(c)},m=0,q=a.length;m<q;m++)if("undefined"!=a[m].e){var k=c.parse(a[m].s),p=c.parse(a[m].e),n=c.date(k),t=c.date(p),v=b+n;n!==t?(null==document.getElementById(v)&&l(n),n=c.convert(k),f(a[m],h(c.parse((+((new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59)).getTime()/1E3)).toString(16)),k)),null==document.getElementById(b+t)&&l(t),k=c.convert(p),f(a[m],h(p,c.parse((+((new Date(k.getFullYear(),
k.getMonth(),k.getDate(),0,0)).getTime()/1E3)).toString(16))))):(null==document.getElementById(v)&&l(n),f(a[m],h(p,k)))}},bar:function(a,b){a=void 0===a?this.log:a;for(var c=document.getElementById(b),d=Log.time,g=0,f=function(a,b){var c=document.createElement("div");c.className="psa sw1 cn fw "+("PHO"==a.c?"bg-blu":"RES"==a.c?"bg-grn":"DSG"==a.c?"bg-red":"ACA"==a.c?"bg-ylw":"bg-blanc");c.style.height=b+"%";c.style.bottom=g+"%";document.getElementById(d.date(d.parse(a.s))).appendChild(c);g+=b},h=
function(a,b){return(a-b)/86400*100},l=function(a){g=0;var b=document.createElement("div");b.className="dib hf psr";b.style.width="3.5714285714285716%";b.id=a;c.appendChild(b)},m=0,q=a.length;m<q;m++)if("undefined"!=a[m].e){var k=d.parse(a[m].s),p=d.parse(a[m].e),n=d.date(k),t=d.date(p);n!==t?(null==document.getElementById(n)&&l(n),n=d.convert(k),f(e,h(d.parse((+((new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59)).getTime()/1E3)).toString(16)),k)),null==document.getElementById(t)&&l(t),k=d.convert(p),
f(e,h(p,d.parse((+((new Date(k.getFullYear(),k.getMonth(),k.getDate(),0,0)).getTime()/1E3)).toString(16))))):(null==document.getElementById(n)&&l(n),f(a[m],h(p,k)))}},day:function(a){a=void 0===a?new Date:a;document.getElementById("daychart");a=Log.data.getEntries(a);for(var b=Log.time,c=0,d=0,g=function(a,b){var f=document.createElement("div");f.className="psr t0 hf mb2 lf "+("PHO"==a.c?"bg-blu":"RES"==a.c?"bg-grn":"DSG"==a.c?"bg-red":"ACA"==a.c?"bg-ylw":"bg-blanc");f.style.width=b.p+"%";f.style.margin=
"0 0 0 "+b.m+"%";document.getElementById("dayChart").appendChild(f);c=b.p;d=b.dp},f=function(a,f){var g=b.convert(f),h=g.getFullYear(),l=g.getMonth(),m=g.getDate();g=((new Date(h,l,m,g.getHours(),g.getMinutes(),g.getSeconds())).getTime()/1E3-(new Date(h,l,m)).getTime()/1E3)/86400*100;return{dp:g,p:(a-f)/86400*100,m:g-(c+d)}},h=0,l=a.length;h<l;h++)"undefined"!=a[h].e&&g(a[h],f(b.parse(a[h].e),b.parse(a[h].s)))},peakH:function(a,b){a=void 0===a?Log.log:a;for(var c=document.getElementById(b),d=Log.data.peakHours(a),
g=Log.utils.getMax(d),f=0,h=d.length;f<h;f++){var l=f,m=document.createElement("div"),q=document.createElement("div"),k=document.createElement("div"),p=b+"-"+l,n=l==(new Date).getHours()?"bg-blanc":"bg-5";m.className="dib hf psr";m.style.width="4.166666666666667%";m.id=p;k.className="sw1 hf cn "+n;q.className="psa b0 wf fw";q.style.height=d[l]/g*100+"%";q.appendChild(k);c.appendChild(m);document.getElementById(p).appendChild(q)}},peakD:function(a,b){a=void 0===a?Log.log:a;b=void 0===b?"peakDaysChart":
b;for(var c=Log.data.peakDays(a),d=Log.utils.getMax(c),g=0,f=c.length;g<f;g++){var h=g,l=document.createElement("div"),m=document.createElement("div"),q=document.createElement("div"),k="peakday-"+h,p=h==(new Date).getDay()?"bg-blanc":"bg-5";l.className="dib hf psr";l.style.width="14.285714285714286%";l.id=k;q.className="sw1 hf cn "+p;m.className="psa b0 wf fw";m.style.height=c[h]/d*100+"%";m.appendChild(q);document.getElementById(b).appendChild(l);document.getElementById(k).appendChild(m)}},sectorBar:function(a,
b){a=void 0===a?Log.log:a;b=void 0===b?"sectorBar":b;for(var c=Log.data.listSectors(a).sort(),d=0,g=c.length;d<g;d++){var f=c[d],h=document.createElement("div"),l=Log.data.sp(a,f);h.className="psr t0 hf mb2 lf bg-"+("PHO"==f?"blu":"RES"==f?"grn":"DSG"==f?"red":"ACA"==f?"ylw":"blanc");h.style.width=l+"%";h.title=f+" ("+l.toFixed(2)+"%)";document.getElementById(b).appendChild(h)}},projectBars:function(a,b){a=void 0===a?Log.log:a;for(var c=Log.data.listProjects(a).sort(),d=0,g=c.length;d<g;d++){var f=
c[d],h=Log.data.ph(a,f),l=document.createElement("li"),m=document.createElement("span"),q=document.createElement("span"),k=document.createElement("div"),p=document.createElement("div");l.className="mb4 f6";m.className="f6 mb2 mon upc tk";q.className="f6 rf";k.className="wf sh1 mb3 bg-noir bsia";p.className="psr t0 hf lf bg-blanc";p.style.width=Log.data.pp(a,f)+"%";m.innerHTML=f;q.innerHTML="LH \u00b7 "+h.toFixed(2);k.appendChild(p);l.appendChild(m);l.appendChild(q);l.appendChild(k);document.getElementById(b).appendChild(l)}}},
time:{parse:function(a){return parseInt(a,16)},convert:function(a){return new Date(1E3*a)},stamp:function(a){var b=Log.time.convert(a);a="0"+b.getHours();var c="0"+b.getMinutes();b="0"+b.getSeconds();return a.substr(-2)+":"+c.substr(-2)+":"+b.substr(-2)},date:function(a){a=Log.time.convert(a);return""+a.getFullYear()+a.getMonth()+a.getDate()},duration:function(a,b){return(b-a)/3600}},data:{getEntries:function(a){var b=[];if(void 0==a)return this.log;for(var c=0,d=Log.log.length;c<d;c++)if("undefined"!=
Log.log[c].e){var g=Log.time.convert(Log.time.parse(Log.log[c].s));g.getFullYear()==a.getFullYear()&&g.getMonth()==a.getMonth()&&g.getDate()==a.getDate()&&b.push(Log.log[c])}return b},getEntriesByDay:function(a){for(var b=[],c=0,d=Log.log.length;c<d;c++)"undefined"!=Log.log[c].e&&Log.time.convert(Log.time.parse(Log.log[c].s)).getDay()==a&&b.push(Log.log[c]);return b},getEntriesByProject:function(a){for(var b=[],c=0,d=Log.log.length;c<d;c++)"undefined"!=Log.log[c].e&&Log.log[c].t==a&&b.push(Log.log[c]);
return b},listProjects:function(a){a=void 0===a?Log.log:a;for(var b=[],c=0,d=a.length;c<d;c++){var g=a[c],f=g.t;"undefined"!=g.e&&-1==b.indexOf(f)&&b.push(f)}return b},listSectors:function(a){a=void 0===a?Log.log:a;for(var b=[],c=0,d=a.length;c<d;c++){var g=a[c],f=g.c;"undefined"!=g.e&&-1==b.indexOf(f)&&b.push(f)}return b},peakDays:function(a){a=void 0===a?Log.log:a;for(var b=[0,0,0,0,0,0,0],c=0,d=a.length;c<d;c++)"undefined"!=a[c].e&&b[Log.time.convert(Log.time.parse(a[c].s)).getDay()]++;return b},
peakHours:function(a){a=void 0===a?Log.log:a;for(var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0,d=a.length;c<d;c++)"undefined"!=a[c].e&&b[Log.time.convert(Log.time.parse(a[c].s)).getHours()]++;return b},lsmin:function(a){a=void 0===a?Log.log:a;if(0==a.length)return 0;for(var b,c=Log.time,d=0,g=a.length;d<g;d++){var f=a[d];f=Number(c.duration(c.parse(f.s),c.parse(f.e)));if(f<b||void 0==b)b=f}return b},lsmax:function(a){a=void 0===a?Log.log:a;if(0==a.length)return 0;for(var b,c=Log.time,
d=0,g=a.length;d<g;d++){var f=a[d];f=Number(c.duration(c.parse(f.s),c.parse(f.e)));if(f>b||void 0==b)b=f}return b},asd:function(a){a=void 0===a?Log.log:a;for(var b=0,c=0,d=0,g=a.length;d<g;d++)if("undefined"!=a[d].e){var f=a[d];b+=Number(Log.time.duration(Log.time.parse(f.s),Log.time.parse(f.e)));c++}return b/c},lh:function(a){a=void 0===a?Log.log:a;if(0==a.length)return 0;for(var b=0,c=0,d=a.length;c<d;c++)if("undefined"!=a[c].e){var g=a[c];b+=Number(Log.time.duration(Log.time.parse(g.s),Log.time.parse(g.e)))}return b},
lp:function(a){a=void 0===a?Log.log:a;if(0==a.length)return 0;var b=Log.time.convert(Log.time.parse(a[0].s)),c=Log.time.convert(Log.time.parse(a[a.length-1].s));a=Number(Log.data.lh(a));b=Math.ceil((new Date(c.getFullYear(),c.getMonth(),c.getDate())-new Date(b.getFullYear(),b.getMonth(),b.getDate()))/864E5);return a/(24*(b+1))*100},sh:function(a,b){a=void 0===a?Log.log:a;for(var c=0,d=0,g=a.length;d<g;d++)if("undefined"!=a[d].e&&a[d].c==b){var f=a[d];c+=Number(Log.time.duration(Log.time.parse(f.s),
Log.time.parse(f.e)))}return c},sp:function(a,b){a=void 0===a?Log.log:a;return Log.data.sh(a,b)/Log.data.lh(a)*100},ph:function(a,b){for(var c=0,d=0,g=a.length;d<g;d++)if("undefined"!=a[d].e&&a[d].t==b){var f=a[d];f=Number(Log.time.duration(Log.time.parse(f.s),Log.time.parse(f.e)));c+=f}return c},pp:function(a,b){a=void 0===a?Log.log:a;return Log.data.ph(a,b)/Log.data.lh(a)*100},trend:function(a,b){return(a-b)/b*100},forecast:function(){for(var a=Log.data.getEntriesByDay((new Date).getDay()),b=Log.data.peakHours(a),
c=0,d=0,g=Log.data.asd(a),f=Log.data.listSectors(a),h=Log.data.listProjects(a),l=0,m="",q=0,k="",p=0,n=b.length;p<n;p++)b[p]>c&&(c=b[p],d=p);b=0;for(n=f.length;b<n;b++)c=Log.data.sp(a,f[b]),c>l&&(l=c,m=f[b]);f=0;for(n=h.length;f<n;f++)l=Log.data.pp(a,h[f]),l>q&&(q=l,k=h[f]);return{sf:m,pf:k,pt:d+":00",sd:g}}},utils:{getMax:function(a){return a.reduce(function(a,c){return Math.max(a,c)})}},openSect:function(a){for(var b=document.getElementsByClassName("sect"),c=document.getElementsByClassName("tab"),
d=0,g=b.length;d<g;d++)b[d].style.display="none";b=0;for(g=c.length;b<g;b++)c[b].className="pv1 tab on bg-noir c-5 f6 mon tk mr3";document.getElementById(a).style.display="block";document.getElementById("b-"+a).className="pv1 tab on bg-noir blanc f6 mon tk mr3"},reset:function(){var a=function(a){document.getElementById(a).innerHTML=""};a("weekChart");a("dayChart");a("peakTimesChart");a("peakDaysChart");a("sectorBar");a("projectStats");a("projectsList");a("vis");a("logbook")},init:function(){Log.log=
log;var a=Log.data,b=new Date,c=new Date(b);c.setDate(b.getDate()-1);var d=Log.data.getEntries(b),g=Log.data.getEntries(c);Log.vis.bar(Log.log,"weekChart");Log.vis.peakH(Log.data.getEntriesByDay(b.getDay()),"peakTimesChart");Log.vis.peakD();Log.vis.day();b=Log.data.forecast();document.getElementById("fsf").innerHTML=b.sf;document.getElementById("fpf").innerHTML=b.pf;document.getElementById("fpt").innerHTML=b.pt;document.getElementById("fsd").innerHTML=b.sd.toFixed(2)+" h";b=Log.status();Log.timer(b);
document.getElementById("status").className=b?"rf mb4 f6 blanc pulse":"rf mb4 f6 noir";var f=a.lh(),h=a.lh(d),l=a.lp(),m=a.lp(d),q=a.asd(),k=a.asd(d),p=a.lsmin(d),n=a.lsmax(d),t=a.lsmin(),v=a.lsmax();b=a.trend(h,a.lh(g));c=a.trend(k,a.asd(g));var r=a.trend(m,a.lp(g)),u=a.trend(p,a.lsmin(g));g=a.trend(n,a.lsmax(g));a="LHH LHT LPH LPT ASD ASDT LSN LSX LSNH LSXH".split(" ");h=[f,h,l,m,q,k,p,n,t,v];f=["lhtt","asdtt","lptt","lsnt","lsxt"];b=[b,c,r,u,g];r=0;for(c=a.length;r<c;r++)document.getElementById(a[r]).innerHTML=
h[r].toFixed(2);a=0;for(c=f.length;a<c;a++)r=void 0,u=b[a],g="",h=document.getElementById(f[a]),0<u?(g="+"+u.toFixed(2)+"%",r="grn"):(g=u.toFixed(2)+"%",r="red"),h.innerHTML=g,h.className=r;Log.vis.peakH(void 0,"peakTimesHistory");Log.vis.sectorBar(d,"sectorBar");Log.vis.projectBars(d,"projectStats");Log.vis.projectBars(void 0,"projectsList");Log.vis.line(Log.log,"vis");Log.display(Log.log,"logbook")}};
